#"FETCH FIRST 200 ROWS ONLY",
.con = connec)
# fetch data
route_40s_pros_route <- st_read(connec, query = sql)
####### tidy prospective data ########
route_40s_pros_route <- route_40s_pros_route %>%
group_by(shape) %>%
# first(start_stop_name) %>%
summarise(delay_per_m = mean(delay_per_m), average_total_occupancy = mean(average_total_occupancy)) %>%
st_transform(4326)
####### leaflet plot of prospective data #########
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route, weight = 2, color = "red", group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
View(route_40s_pros_route)
# sql query (using glue package for syntax formatting)
sql <- glue_sql( "SELECT * FROM prospective.congestion ",
"WHERE bounding_start_stop IN ({route_40s_stops*}) ",
"AND data_period = '2023 Oct - 2023 Dec' ",
#"AND hour_of_day = '08:00:00' " ,
#"FETCH FIRST 200 ROWS ONLY",
.con = connec)
# fetch data
route_40s_pros_route <- st_read(connec, query = sql)
View(route_40s_pros_route)
####### tidy prospective data ########
route_40s_pros_route_tidy <- route_40s_pros_route %>%
group_by(shape, hour_of_day) %>%
# first(start_stop_name) %>%
summarise(delay_per_m = mean(delay_per_m), average_total_occupancy = mean(average_total_occupancy)) %>%
st_transform(4326)
View(route_40s_pros_route)
# sql query (using glue package for syntax formatting)
sql <- glue_sql( "SELECT * FROM prospective.congestion ",
"WHERE bounding_start_stop IN ({route_40s_stops*}) ",
"AND bounding_end_stop IN ({route_40s_stops*}) ",
"AND data_period = '2023 Oct - 2023 Dec' ",
#"AND hour_of_day = '08:00:00' " ,
#"FETCH FIRST 200 ROWS ONLY",
.con = connec)
# fetch data
route_40s_pros_route <- st_read(connec, query = sql)
####### tidy prospective data ########
route_40s_pros_route_tidy <- route_40s_pros_route %>%
group_by(shape, hour_of_day) %>%
# first(start_stop_name) %>%
summarise(delay_per_m = mean(delay_per_m), average_total_occupancy = mean(average_total_occupancy)) %>%
st_transform(4326)
####### leaflet plot of prospective data #########
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 2, color = "red", group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
View(route_40s_pros_route_tidy)
####### leaflet plot of prospective data #########
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 2, color = average_total_occupancy, group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
####### leaflet plot of prospective data #########
# palette
pal <- colorNumeric(palette = "viridis", domain = route_40s_pros_route_tidy$average_total_occupancy)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 2, color = pal(average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 2, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
View(route_40s_pros_route_tidy)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% filter(hour_of_day == "08:00:00"), weight = 2, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
View(route_40s_pros_route_tidy)
View(route_40s_pros_route_tidy)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% slice(1:50), weight = 4, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% slice(1:10), weight = 4, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% slice(5), weight = 4, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% head(5), weight = 4, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy %>% head(50), weight = 4, color = pal(route_40s_pros_route_tidy$average_total_occupancy), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
View(route_40s_pros_route_tidy)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 4, color = pal(route_40s_pros_route_tidy$delay_per_m), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
####### leaflet plot of prospective data #########
# palette
pal <- colorNumeric(palette = "viridis", domain = route_40s_pros_route_tidy$delay_per_m)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 4, color = pal(route_40s_pros_route_tidy$delay_per_m), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
####### leaflet plot of prospective data #########
# palette
pal <- colorFactor(palette = "viridis", levels = levels(route_40s_pros_route_tidy$delay_per_m))
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 4, color = ~pal(route_40s_pros_route_tidy$delay_per_m), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
####### leaflet plot of prospective data #########
# palette
pal <- colorBin(palette = "Blues", domain = route_40s_pros_route_tidy$delay_per_m, 6, pretty = FALSE)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 4, color = ~pal(route_40s_pros_route_tidy$delay_per_m), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
####### leaflet plot of prospective data #########
# palette
pal <- colorQuantile(palette = "Blues", domain = route_40s_pros_route_tidy$delay_per_m, 6, pretty = FALSE)
####### leaflet plot of prospective data #########
# palette
pal <- colorQuantile(palette = "Blues", domain = route_40s_pros_route_tidy$delay_per_m, 6)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
#addProviderTiles(providers$CartoDB.DarkMatter) %>%
#addPolylines(data = shapes, weight = 2, color = "purple", group = "BOD data" ) %>%
#addPolylines(data = bus_routes, weight = 2, color = "cyan", group = "theo DB data") %>%
addPolylines(data = route_40s_pros_route_tidy, weight = 4, color = ~pal(route_40s_pros_route_tidy$delay_per_m), group = "prospective data") %>%
addLayersControl(baseGroups = c("BOD data", "theo DB data", "prospective data"), options = layersControlOptions(collapsed = FALSE))
setwd("C:/Users/tom.alexander1/OneDrive - West Of England Combined Authority/Transport/7.0 Data/MATsim/matsim_wofe")
setwd("C:/Users/tom.alexander1/OneDrive - West Of England Combined Authority/Transport/7.0 Data/MATsim/matsim_wofe")
source("r/pop_profile.R")
library(tidyverse)
library(tictoc)
library(parallel)
library(VGAM)
library(hms)
library(sf)
source("r/pop_profile.R")
source("r/pop_expander.R")
View(pop)
rm(threeLetNames, alphaNumerics, profileTypes, agentNameGen, agentNameGen2, agentNameGenAlphaNum, popExpander,
alphaNumSmall, nameGenX, agentNameGenSimple1, agentNameGenSimple2, constonants, vowels)
sampleSize  <- 100     #for testing set smaller pop sample size
#pop <- sample_oa_pop     # or use an Output Area sample (e.g. Yate OAs or OAs on bus route 6 or 7)
myPop <- sample_n(pop, sampleSize)  # get a sample pop
source("r/help_fun/addHomeXY.R")
source("r/help_fun/addWorkXY.R")
source("r/help_fun/addTimes.R")
source("r/help_fun/addAttrs.R")
source("r/help_fun/loadPointData.R")
source('r/plan_fun/lapply_INDY.R')
source('r/plan_fun/lapply_OFFC.R')
source('r/plan_fun/lapply_HIGH.R')
source('r/plan_fun/lapply_HLTH.R')
source('r/plan_fun/lapply_EDUC.R')
source('r/plan_fun/lapply_CONS.R')
source('r/plan_fun/lapply_NOWK.R')
tic("just lapply")
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_6_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
View(myPop_with_acts)
View(myPopList)
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
View(myPopList)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
View(profileSums)
View(myPop)
View(myPop_with_acts)
View(myPop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
View(myPop_with_acts)
View(myPop)
source("r/pop_profile.R")
source("r/pop_expander.R")
sampleSize  <- 100     #for testing set smaller pop sample size
#pop <- sample_oa_pop     # or use an Output Area sample (e.g. Yate OAs or OAs on bus route 6 or 7)
myPop <- sample_n(pop, sampleSize)  # get a sample pop
source("r/help_fun/addHomeXY.R")
source("r/help_fun/addWorkXY.R")
source("r/help_fun/addTimes.R")
source("r/help_fun/addAttrs.R")
source("r/help_fun/loadPointData.R")
source('r/plan_fun/lapply_INDY.R')
source('r/plan_fun/lapply_OFFC.R')
source('r/plan_fun/lapply_HIGH.R')
source('r/plan_fun/lapply_HLTH.R')
source('r/plan_fun/lapply_EDUC.R')
source('r/plan_fun/lapply_CONS.R')
source('r/plan_fun/lapply_NOWK.R')
myPopList <- split(myPop, seq(nrow(myPop)))
View(myPopList)
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
View(myPop_with_acts)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
tic("just lapply")
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_6_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
sampleSize  <- 200     #for testing set smaller pop sample size
#pop <- sample_oa_pop     # or use an Output Area sample (e.g. Yate OAs or OAs on bus route 6 or 7)
myPop <- sample_n(pop, sampleSize)  # get a sample pop
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
View(myPop_with_acts)
View(myPop_with_acts)
View(HOME_points)
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
View(myPop_with_acts)
source("r/help_fun/addHomeXY.R")
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
View(myPop_with_acts)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_6_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
View(myPop_with_acts)
View(HOME_points)
HOME_points <- HOME_points %>% select(-X.1)
source("r/pop_profile.R")
source("r/pop_expander.R")
sampleSize  <- 250     #for testing set smaller pop sample size
#pop <- sample_oa_pop     # or use an Output Area sample (e.g. Yate OAs or OAs on bus route 6 or 7)
myPop <- sample_n(pop, sampleSize)  # get a sample pop
source("r/help_fun/addHomeXY.R")
source("r/help_fun/addWorkXY.R")
source("r/help_fun/addTimes.R")
source("r/help_fun/addAttrs.R")
source("r/help_fun/loadPointData.R")
source('r/plan_fun/lapply_INDY.R')
source('r/plan_fun/lapply_OFFC.R')
source('r/plan_fun/lapply_HIGH.R')
source('r/plan_fun/lapply_HLTH.R')
source('r/plan_fun/lapply_EDUC.R')
source('r/plan_fun/lapply_CONS.R')
source('r/plan_fun/lapply_NOWK.R')
#tic("just lapply")
#myPopTest <- lapply(myPopList,addHomeList)
#rm(HOME_points, myPopList)
#myPopTest <- lapply(myPopTest,INDY_1_fun)
#myPopTest <- lapply(myPopTest,NOWK_3_fun)
#myPopTest <- lapply(myPopTest,INDY_3_fun)
#myPopTest <- lapply(myPopTest,INDY_4_fun)
#toc()
tic("just lapply")
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_6_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
toc()
sampleSize  <- 1000     #for testing set smaller pop sample size
#pop <- sample_oa_pop     # or use an Output Area sample (e.g. Yate OAs or OAs on bus route 6 or 7)
myPop <- sample_n(pop, sampleSize)  # get a sample pop
tic("just lapply")
myPopList <- split(myPop, seq(nrow(myPop)))
myPop_with_acts <- lapply(myPopList,addAttrsLoop)
myPop_with_acts <- lapply(myPop_with_acts,addHomeLoop)
myPop_with_acts <- lapply(myPop_with_acts,INDY_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,INDY_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,OFFC_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HIGH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,HLTH_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,EDUC_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,CONS_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_1_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_2_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_3_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_4_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_5_fun)
myPop_with_acts <- lapply(myPop_with_acts,NOWK_6_fun)
myPop_with_acts <- as.data.frame(do.call(rbind, myPop_with_acts))
toc()
